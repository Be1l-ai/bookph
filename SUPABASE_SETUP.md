# Supabase Setup Guide for BookPH

## Database Extensions

Good news! **BookPH does not require any special PostgreSQL extensions** to work with Supabase.

### Why No Extensions Are Needed

The Cal.com/BookPH schema uses UUID fields extensively (e.g., `@db.Uuid`, `@default(uuid())`), but:

1. **PostgreSQL 13+ has built-in UUID support** - No need for the `uuid-ossp` extension
2. **Supabase provides PostgreSQL 15+** - All UUID functions are available by default
3. **Prisma generates UUIDs at the application level** - Most UUIDs are generated by Prisma, not by the database

### Database Configuration

When setting up your Supabase database:

```env
# Direct connection (for migrations)
DATABASE_DIRECT_URL="postgresql://postgres:[PASSWORD]@[PROJECT-REF].supabase.co:5432/postgres"

# Pooled connection (for application queries)
DATABASE_URL="postgresql://postgres:[PASSWORD]@[PROJECT-REF].supabase.co:6543/postgres?pgbouncer=true"
```

**Important Notes:**
- Port 5432: Direct connection (use for migrations)
- Port 6543: Connection pooler (use for application)
- Both are available in your Supabase project settings under "Database"

### Running Migrations

```bash
# Run migrations using the direct connection
yarn workspace @calcom/prisma db-migrate
```

### Optional: Enable Extensions (If Needed Later)

If you ever need to enable additional extensions in Supabase:

1. Go to your Supabase Dashboard
2. Navigate to "Database" â†’ "Extensions"
3. Search for the extension and click "Enable"

Common extensions you might want (all optional):
- `pg_stat_statements` - Query performance monitoring (often pre-enabled)
- `pg_trgm` - Text search improvements (useful for search features)

### Performance Recommendations

For production use with Supabase:

1. **Enable Connection Pooling** - Use the pooled connection URL for your app
2. **Use Direct URL for Migrations** - Always use the direct connection for schema changes
3. **Monitor Query Performance** - Use Supabase's built-in query analyzer
4. **Set up regular backups** - Supabase provides point-in-time recovery

### Troubleshooting

**Issue: "relation does not exist" errors**
- Solution: Run migrations using `DATABASE_DIRECT_URL`

**Issue: Connection timeout**
- Solution: Check if you're using the correct port (5432 vs 6543)
- Verify your IP is allowed in Supabase connection settings

**Issue: Too many connections**
- Solution: Use the pooled connection (port 6543) for your application

## Next Steps

1. Copy your Supabase connection strings to `.env`
2. Run the database migrations
3. Test the connection with `yarn db-studio`

That's it! Your Supabase database is ready for BookPH.
